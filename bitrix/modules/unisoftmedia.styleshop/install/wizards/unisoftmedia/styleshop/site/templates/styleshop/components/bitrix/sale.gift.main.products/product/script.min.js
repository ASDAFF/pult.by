BX.namespace("BX.Sale"),BX.Sale.GiftMainProductsClass=function(){var a=function(a){this.ajaxUrl="/bitrix/components/bitrix/sale.gift.main.products/ajax.php",this.contextAjaxData=a.contextAjaxData||{},this.mainProductState=a.mainProductState||null,this.injectId=a.injectId||null,this.isGift=!!a.isGift,this.productId=a.productId,this.offerId=a.offerId,this.offers=a.offers||[],this.setEvents(),document.location.hash.match(/as_gift/g)&&(this.isGift?this.enableGift():this.raiseNonGiftEvent()),BX.bindDelegate(BX(this.injectId),"click",{tagName:"a"},BX.proxy(this.clickNavLink,this))};return a.prototype.clickNavLink=function(a){if(this.onPageNavigationByLink(BX.proxy_context))return BX.PreventDefault(a)},a.prototype.setEvents=function(){BX.addCustomEvent("onCatalogStoreProductChange",BX.proxy(this.onCatalogStoreProductChange,this)),BX.addCustomEvent("onAddToBasketMainProduct",BX.proxy(this.onAddToBasketMainProduct,this))},a.prototype.unsubscribeEvents=function(){BX.removeCustomEvent("onCatalogStoreProductChange",BX.proxy(this.onCatalogStoreProductChange,this))},a.prototype.onAddToBasketMainProduct=function(a){this.enableGift()},a.prototype.onCatalogStoreProductChange=function(a){a!=this.offerId&&BX.ajax({url:this.ajaxUrl,method:"POST",data:BX.merge(this.contextAjaxData,{offerId:a,mainProductState:this.mainProductState,SITE_ID:BX.message("SITE_ID")}),dataType:"html",processData:!1,start:!0,onsuccess:BX.delegate(function(b){this.offerId=a;var c=BX.processHTML(b);return c.HTML?(this.unsubscribeEvents(),BX(this.injectId).innerHTML=c.HTML,void BX.ajax.processScripts(c.SCRIPT)):void(document.location.hash.match(/as_gift/g)&&(this.isGift?this.raiseGiftEvent():this.raiseNonGiftEvent()))},this)})},a.prototype.onPageNavigationByLink=function(a){var b=BX.delegate(function(a){return!(!BX.type.isElementNode(a)||!a.href)&&(a.href.indexOf(this.ajaxUrl)>=0||a.href.indexOf("PAGEN_")!==-1)},this);return!!b(a)&&(BX.ajax({url:a.href,method:"POST",data:BX.merge(this.contextAjaxData,{SITE_ID:BX.message("SITE_ID")}),dataType:"html",processData:!1,start:!0,onsuccess:BX.delegate(function(a){var b=BX.processHTML(a);b.HTML&&(this.unsubscribeEvents(),BX(this.injectId).innerHTML=b.HTML,BX.ajax.processScripts(b.SCRIPT))},this)}),!0)},a.prototype.enableGift=function(){this.isGift=!0,this.raiseGiftEvent()},a.prototype.raiseGiftEvent=function(){BX.onCustomEvent("onSaleProductIsGift",[this.productId,this.offerId])},a.prototype.raiseNonGiftEvent=function(){BX.onCustomEvent("onSaleProductIsNotGift",[this.productId,this.offerId])},a}();