!function(a,b,c,d){"use strict";b.JSCatalog||(b.JSCatalog=function(a){if(this.productType=0,this.showQuantity=!0,this.showAbsent=!0,this.secondPict=!1,this.showOldPrice=!1,this.showPercent=!1,this.showSkuProps=!1,this.showClosePopup=!1,this.useStore=!1,this.useCompare=!1,this.useSubscribe=!1,this.visual={ID:"",PICT_ID:"",SECOND_PICT_ID:"",QUANTITY_ID:"",QUANTITY_UP_ID:"",QUANTITY_DOWN_ID:"",PRICE_ID:"",DSC_PERC:"",SECOND_DSC_PERC:"",DISPLAY_PROP_DIV:""},this.product={name:"",pict:{},id:0,addUrl:"",buyUrl:""},this.defaultPict={pict:null,secondPict:null},this.canBuy=!0,this.offers=[],this.offerNum=0,this.treeProps=[],this.obTreeRows=[],this.showCount=[],this.showStart=[],this.selectedValues={},this.obProduct=null,this.obQuantity=null,this.obQuantityNameMeasure=null,this.obPict=null,this.obSecondPict=null,this.sliderList=null,this.offerGroup=null,this.obAvailable=null,this.obPrice=null,this.obOldPrice=null,this.obTree=null,this.obBuyBtn=null,this.obNotAvail=null,this.obDscPerc=null,this.obSecondDscPerc=null,this.obSkuProps=null,this.obMeasure=null,this.obSubscribe=null,this.treeRowShowSize=5,this.errorCode=0,"object"==typeof a)switch(this.productType=parseInt(a.PRODUCT_TYPE,10),this.showQuantity=a.SHOW_QUANTITY,this.showAbsent=a.SHOW_ABSENT,this.secondPict=!!a.SECOND_PICT,this.showOldPrice=!!a.SHOW_OLD_PRICE,this.showPercent=!!a.SHOW_DISCOUNT_PERCENT,this.showSkuProps=!!a.SHOW_SKU_PROPS,this.showClosePopup=!!a.SHOW_CLOSE_POPUP,this.useCompare=!!a.DISPLAY_COMPARE,this.useStore=!!a.USE_STORE,this.useSubscribe=!!a.USE_SUBSCRIBE,this.visual=a.VISUAL,this.productType){case 3:a.OFFERS&&BX.type.isArray(a.OFFERS)&&(a.PRODUCT&&"object"==typeof a.PRODUCT&&(this.product.name=a.PRODUCT.NAME,this.product.id=a.PRODUCT.ID),this.offers=a.OFFERS,this.offerNum=0,a.OFFER_SELECTED&&(this.offerNum=parseInt(a.OFFER_SELECTED,10)),isNaN(this.offerNum)&&(this.offerNum=0),a.TREE_PROPS&&(this.treeProps=a.TREE_PROPS),a.DEFAULT_PICTURE&&(this.defaultPict.pict=a.DEFAULT_PICTURE.PICTURE,this.defaultPict.secondPict=a.DEFAULT_PICTURE.PICTURE_SECOND));break;default:this.errorCode=-1}0===this.errorCode&&BX.ready(BX.delegate(this.Init,this))},b.JSCatalog.prototype.Init=function(){var a=0,b="",c=null;if(this.obProduct=BX(this.visual.ID),this.obProduct||(this.errorCode=-1),this.visual.PICT_ID&&(this.obPict=BX(this.visual.PICT_ID)),this.secondPict&&this.visual.SECOND_PICT_ID&&(this.obSecondPict=BX(this.visual.SECOND_PICT_ID)),this.visual.SLIDER_LIST_OF_ID&&(this.sliderList=BX(this.visual.SLIDER_LIST_OF_ID+this.offers[this.offerNum].ID)),this.visual.OFFER_GROUP&&(this.offerGroup=BX(this.visual.OFFER_GROUP+this.offers[this.offerNum].ID)),this.visual.AVAILABLE_ID&&(this.obAvailable=BX(this.visual.AVAILABLE_ID)),this.useSubscribe&&(this.obSubscribe=BX(this.visual.SUBSCRIBE_ID)),this.showQuantity&&this.visual.QUANTITY_MEASURE&&(this.obQuantity=BX(this.visual.QUANTITY_MEASURE),this.visual.NAME_MEASURE&&(this.obQuantityNameMeasure=BX(this.visual.NAME_MEASURE))),this.obPrice=BX(this.visual.PRICE_ID),this.obPrice||(this.errorCode=-16),this.showOldPrice&&this.visual.OLD_PRICE_ID&&(this.obOldPrice=BX(this.visual.OLD_PRICE_ID)),this.visual.BUY_ID&&(this.obBuyBtn=BX(this.visual.BUY_ID)),3===this.productType&&this.offers.length>0){if(this.visual.TREE_ID)for(this.obTree=BX(this.visual.TREE_ID),this.obTree||(this.errorCode=-256),b=this.visual.TREE_ITEM_ID,a=0;a<this.treeProps.length;a++)if(this.obTreeRows[a]={LIST:BX(b+this.treeProps[a].ID+"_list"),CONT:BX(b+this.treeProps[a].ID+"_cont"),SEL:BX(b+this.treeProps[a].ID+"_selected")},!this.obTreeRows[a].LIST||!this.obTreeRows[a].CONT){this.errorCode=-512;break}this.visual.QUANTITY_MEASURE&&(this.obMeasure=BX(this.visual.QUANTITY_MEASURE))}if(this.visual.NOT_AVAILABLE_MESS&&(this.obNotAvail=BX(this.visual.NOT_AVAILABLE_MESS)),this.showPercent&&(this.visual.DSC_PERC&&(this.obDscPerc=BX(this.visual.DSC_PERC)),this.secondPict&&this.visual.SECOND_DSC_PERC&&(this.obSecondDscPerc=BX(this.visual.SECOND_DSC_PERC))),this.showSkuProps&&this.visual.DISPLAY_PROP_DIV&&(this.obSkuProps=BX(this.visual.DISPLAY_PROP_DIV)),0===this.errorCode)switch(this.productType){case 1:break;case 3:if(this.offers.length>0){if((c=BX.findChildren(this.obTree,{tagName:"li"},!0))&&0<c.length)for(a=0;a<c.length;a++)BX.bind(c[a],"click",BX.delegate(this.SelectOfferProp,this));this.SetCurrent()}}},b.JSCatalog.prototype.SelectOfferProp=function(){var g,b=0,c="",d="",e=[],f=null,h=BX.proxy_context;if(h&&h.hasAttribute("data-treevalue")&&(d=h.getAttribute("data-treevalue"),e=d.split("_"),this.SearchOfferPropIndex(e[0],e[1])&&(f=BX.findChildren(h.parentNode,{tagName:"li"},!1))&&0<f.length))for(b=0;b<f.length;b++)c=f[b].getAttribute("data-onevalue"),c===e[1]?(g=a(h).closest(".block-sku-detail-sku").children("span"),g.children(".selection").html(f[b].getAttribute("data-sku-title")),g.children(".cnt_item").css("background-image","url("+f[b].getAttribute("data-color")+")"),BX.addClass(f[b],"active")):BX.removeClass(f[b],"active")},b.JSCatalog.prototype.SearchOfferPropIndex=function(a,b){var e,f,c="",d=!1,g=[],h=[],i=-1,j={},k=[];for(e=0;e<this.treeProps.length;e++)if(this.treeProps[e].ID===a){i=e;break}if(-1<i){for(e=0;e<i;e++)c="PROP_"+this.treeProps[e].ID,j[c]=this.selectedValues[c];if(c="PROP_"+this.treeProps[i].ID,!(d=this.GetRowValues(j,c)))return!1;if(!BX.util.in_array(b,d))return!1;for(j[c]=b,e=i+1;e<this.treeProps.length;e++){if(c="PROP_"+this.treeProps[e].ID,!(d=this.GetRowValues(j,c)))return!1;if(h=[],this.showAbsent)for(g=[],k=[],k=BX.clone(j,!0),f=0;f<d.length;f++)k[c]=d[f],h[h.length]=d[f],this.GetCanBuy(k)&&(g[g.length]=d[f]);else g=d;this.selectedValues[c]&&BX.util.in_array(this.selectedValues[c],g)?j[c]=this.selectedValues[c]:this.showAbsent?j[c]=g.length>0?g[0]:h[0]:j[c]=g[0],this.UpdateRow(e,j[c],d,g)}this.selectedValues=j,this.ChangeInfo()}return!0},b.JSCatalog.prototype.UpdateRow=function(b,c,d,e){var f=0,g=0,h="",i=0,j={},k=!1,l=!1,m=0,n=0,o=null;if(-1<b&&b<this.obTreeRows.length&&(o=BX.findChildren(this.obTreeRows[b].LIST,{tagName:"li"},!1))&&0<o.length){for(i=d.length,k=this.treeRowShowSize<i,j={props:{className:""},style:{}},f=0;f<o.length;f++)h=o[f].getAttribute("data-onevalue"),l=h===c,BX.util.in_array(h,e)?(l&&(a(this.obTreeRows[b].SEL).children(".selection").html(o[f].getAttribute("data-sku-title")).end().children(".cnt_item").css("background-image","url("+o[f].getAttribute("data-color")+")"),a(this.obTreeRows[b].CONT).children('[data-toggle="dropdown"]').children(".selection").html(o[f].getAttribute("data-sku-title")).end().children(".cnt_item").css("background-image","url("+o[f].getAttribute("data-color")+")")),j.props.className=l?"active":""):(l&&(a(this.obTreeRows[b].SEL).children(".selection").html(o[f].getAttribute("data-sku-title")).end().children(".cnt_item").css("background-image","url("+o[f].getAttribute("data-color")+")"),a(this.obTreeRows[b].CONT).children('[data-toggle="dropdown"]').children(".selection").html(o[f].getAttribute("data-sku-title")).end().children(".cnt_item").css("background-image","url("+o[f].getAttribute("data-color")+")")),j.props.className=l?"active disabled":"disabled"),j.style.display="none",BX.util.in_array(h,d)&&(j.style.display="",l&&(m=g),g++),BX.adjust(o[f],j);k&&this.treeRowShowSize<=m&&(n=this.treeRowShowSize-m-1),this.showCount[b]=i,this.showStart[b]=n}},b.JSCatalog.prototype.GetRowValues=function(a,b){var d,c=0,e=[],f=!1,g=!0;if(0===a.length){for(c=0;c<this.offers.length;c++)BX.util.in_array(this.offers[c].TREE[b],e)||(e[e.length]=this.offers[c].TREE[b]);f=!0}else for(c=0;c<this.offers.length;c++){g=!0;for(d in a)if(a[d]!==this.offers[c].TREE[d]){g=!1;break}g&&(BX.util.in_array(this.offers[c].TREE[b],e)||(e[e.length]=this.offers[c].TREE[b]),f=!0)}return!!f&&e},b.JSCatalog.prototype.GetCanBuy=function(a){var c,b=0,d=!1,e=!0;for(b=0;b<this.offers.length;b++){e=!0;for(c in a)if(a[c]!==this.offers[b].TREE[c]){e=!1;break}if(e&&this.offers[b].CAN_BUY){d=!0;break}}return d},b.JSCatalog.prototype.SetCurrent=function(){var a=0,b=0,c=[],d="",e=!1,f={},g=[],h=this.offers[this.offerNum].TREE;for(a=0;a<this.treeProps.length&&(d="PROP_"+this.treeProps[a].ID,e=this.GetRowValues(f,d));a++){if(BX.util.in_array(h[d],e)?f[d]=h[d]:(f[d]=e[0],this.offerNum=0),this.showAbsent)for(c=[],g=[],g=BX.clone(f,!0),b=0;b<e.length;b++)g[d]=e[b],this.GetCanBuy(g)&&(c[c.length]=e[b]);else c=e;this.UpdateRow(a,f[d],e,c)}this.selectedValues=f,this.ChangeInfo()},b.JSCatalog.prototype.ChangeInfo=function(){var c,f,g,b=0,d=-1,e=!0,h={};for(b=0;b<this.offers.length;b++){e=!0;for(c in this.selectedValues)if(this.selectedValues[c]!==this.offers[b].TREE[c]){e=!1;break}if(e){d=b;break}}if(-1<d){if(h={Offers:this.offers,offer:this.offers[d],visual:this.visual},g=a(this.obProduct),g.trigger(f=a.Event("starthtml.offers",h)),f.isDefaultPrevented())return;if(this.obPict&&(this.offers[d].PREVIEW_PICTURE?this.obPict.setAttribute("src",this.offers[d].PREVIEW_PICTURE.SRC):this.obPict.setAttribute("src",this.defaultPict.pict.SRC)),this.secondPict&&this.obSecondPict&&(this.offers[d].PREVIEW_PICTURE_SECOND?this.obSecondPict.setAttribute("src",this.offers[d].PREVIEW_PICTURE_SECOND.SRC):this.offers[d].PREVIEW_PICTURE.SRC?this.obSecondPict.setAttribute("src",this.offers[d].PREVIEW_PICTURE.SRC):this.defaultPict.secondPict?this.obSecondPict.setAttribute("src",this.defaultPict.secondPict.SRC):this.obSecondPict.setAttribute("src",this.defaultPict.pict.SRC)),this.sliderList&&(BX.adjust(this.sliderList,{style:{display:"none"}}),this.sliderList=BX(this.visual.SLIDER_LIST_OF_ID+this.offers[d].ID),BX.adjust(this.sliderList,{style:{display:"block"}})),this.offerGroup&&(BX.adjust(this.offerGroup,{style:{display:"none"}}),this.offerGroup=BX(this.visual.OFFER_GROUP+this.offers[d].ID),BX.adjust(this.offerGroup,{style:{display:"block"}})),this.obAvailable&&(0<parseFloat(this.offers[d].MAX_QUANTITY)?(BX.removeClass(this.obAvailable,"text-danger"),BX.addClass(this.obAvailable,"text-success"),BX.adjust(this.obAvailable,{html:this.visual.IN_STOCK})):(BX.removeClass(this.obAvailable,"text-success"),BX.addClass(this.obAvailable,"text-danger"),BX.adjust(this.obAvailable,{html:this.visual.NOT_STOCK}))),this.canBuy=this.offers[d].CAN_BUY,this.obBuyBtn&&(this.canBuy?(BX.style(this.obBuyBtn,"display",""),this.obNotAvail&&BX.style(this.obNotAvail,"display","none"),this.obBuyBtn.setAttribute("data-elementid",this.offers[d].ID),this.inBasket(this.offers[d].ID)):(BX.style(this.obBuyBtn,"display","none"),this.obNotAvail&&BX.style(this.obNotAvail,"display","")),BX.removeClass(this.obBuyBtn,"add2basket_"+this.offers[this.offerNum].ID),BX.addClass(this.obBuyBtn,"add2basket_"+this.offers[d].ID)),this.canBuy)this.useSubscribe&&this.obSubscribe&&BX.style(this.obSubscribe,"display","none");else if(this.useSubscribe&&this.obSubscribe){BX.style(this.obSubscribe,"display",""),this.obSubscribe.setAttribute("data-item",this.offers[d].ID);var i=BX(this.visual.SUBSCRIBE_ID+"_hidden");i&&i.click()}if(this.obQuantity&&(0<parseFloat(this.offers[d].STEP_QUANTITY)&&(this.obQuantity.setAttribute("step",parseFloat(this.offers[d].STEP_QUANTITY)),this.obQuantity.value=parseFloat(this.offers[d].STEP_QUANTITY)),this.offers[d].CHECK_QUANTITY?(this.obQuantity.setAttribute("data-check",!0),this.obQuantity.setAttribute("data-max",this.offers[d].MAX_QUANTITY)):this.obQuantity.setAttribute("data-check",!1),this.obQuantityNameMeasure&&BX.adjust(this.obQuantityNameMeasure,{html:this.offers[d].MEASURE})),this.showSkuProps&&this.obSkuProps)if(this.offers[d].DISPLAY_PROPERTIES&&0!==this.offers[d].DISPLAY_PROPERTIES.length){var j="";for(var k in this.offers[d].DISPLAY_PROPERTIES)j+="<dt>"+this.offers[d].DISPLAY_PROPERTIES[k].NAME+"</dt>",j+="<dd>"+this.offers[d].DISPLAY_PROPERTIES[k].VALUE+"</dd>";BX.adjust(this.obSkuProps,{style:{display:""},html:j})}else BX.adjust(this.obSkuProps,{style:{display:"none"},html:""});this.useStore&&BX.onCustomEvent("onCatalogStoreProductChange",[this.offers[d].ID]),this.setPrice(this.offers[d].PRICE),g.trigger(a.Event("endhtml.offers",h)),this.offerNum=d}},b.JSCatalog.prototype.inBasket=function(a){var b;$in_basket&&0<parseInt($in_basket[a])?(b=BX.parseJSON(this.obBuyBtn.getAttribute("data-options")),BX.removeClass(this.obBuyBtn,"add2basket"),this.obBuyBtn.setAttribute("title",b.inBasket),this.obBuyBtn.querySelector(".text").innerHTML=b.inBasket,this.obBuyBtn.setAttribute("href",b.basketUrl)):(b=BX.parseJSON(this.obBuyBtn.getAttribute("data-options")),BX.addClass(this.obBuyBtn,"add2basket"),this.obBuyBtn.setAttribute("title",b.outBasket),this.obBuyBtn.querySelector(".text").innerHTML=b.outBasket,this.obBuyBtn.setAttribute("href",b.detailPageUrl))},b.JSCatalog.prototype.setPrice=function(a){var b,c;this.obPrice&&(b=a.PRINT_DISCOUNT_VALUE,this.showOldPrice&&this.obOldPrice&&(a.DISCOUNT_VALUE!==a.VALUE?(BX.adjust(this.obOldPrice,{style:{display:""},html:a.PRINT_VALUE}),BX.addClass(this.obPrice,"old")):(BX.adjust(this.obOldPrice,{style:{display:"none"},html:""}),BX.removeClass(this.obPrice,"old"))),BX.adjust(this.obPrice,{html:b}),this.showPercent&&(c=a.DISCOUNT_VALUE!==a.VALUE?{style:{display:""},html:"-"+a.DISCOUNT_DIFF_PERCENT+"%"}:{style:{display:"none"},html:""},this.obDscPerc&&BX.adjust(this.obDscPerc,c),this.obSecondDscPerc&&BX.adjust(this.obSecondDscPerc,c)))})}(window.jQuery,window,document);