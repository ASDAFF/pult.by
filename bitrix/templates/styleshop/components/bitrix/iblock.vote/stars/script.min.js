!function(a){a.JCIblockVoteStars||(JCIblockVoteStars=function(a){this.progressId=a.progressId,this.ratingId=a.ratingId,this.starsId=a.starsId,this.ajaxUrl=a.ajaxUrl,this.voteId=a.voteId,this.starsObj=null,this.votedValue=null,this.preVotedValue=null},JCIblockVoteStars.prototype.setValue=function(a){a=parseInt(a),isNaN(a)?a=0:a>100?a=100:a<0&&(a=0);var b=BX(this.progressId);b&&(b.style.width=parseInt(a)+"%",this.votedValue=a)},JCIblockVoteStars.prototype.setVotes=function(a){var b=BX(this.ratingId);b&&(b.innerHTML="( "+a+" )")},JCIblockVoteStars.prototype.getStarsObj=function(){return this.starsObj||(this.starsObj=BX(this.starsId)),this.starsObj},JCIblockVoteStars.prototype.onMouseMove=function(a){for(var b=BX.pos(this.getStarsObj()),c=(a.pageX-b.left)/b.width*5,d=1;d<=5;d++)if(c<d){c=d;break}this.setValue(20*c)},JCIblockVoteStars.prototype.onMouseOver=function(a){BX.bind(this.getStarsObj(),"click",BX.proxy(this.onVote,this)),this.preVotedValue=this.votedValue},JCIblockVoteStars.prototype.onMouseOut=function(a){BX.unbind(this.getStarsObj(),"click",BX.proxy(this.onVote,this)),this.votedValue=this.preVotedValue,this.setValue(this.votedValue)},JCIblockVoteStars.prototype.onVote=function(a){this.unBindEvents(),this.ajaxParams.rating=parseInt(this.votedValue/20)-1,this.ajaxParams.vote="Y",this.ajaxParams.vote_id=this.voteId,BX.ajax({timeout:30,method:"POST",dataType:"json",url:this.ajaxUrl,data:this.ajaxParams,onsuccess:BX.delegate(this.SetResult,this)})},JCIblockVoteStars.prototype.SetResult=function(a){a&&!a.ERROR&&(this.setValue(20*(a.value+1)),this.setVotes(a.votes))},JCIblockVoteStars.prototype.bindEvents=function(){var a=this.getStarsObj();BX.bind(a,"mousemove",BX.proxy(this.onMouseMove,this)),BX.bind(a,"mouseover",BX.proxy(this.onMouseOver,this)),BX.bind(a,"mouseout",BX.proxy(this.onMouseOut,this))},JCIblockVoteStars.prototype.unBindEvents=function(){var a=this.getStarsObj();BX.unbind(a,"mousemove",BX.proxy(this.onMouseMove,this)),BX.unbind(a,"mouseover",BX.proxy(this.onMouseOver,this)),BX.unbind(a,"mouseout",BX.proxy(this.onMouseOut,this)),BX.unbind(this.getStarsObj(),"click",BX.proxy(this.onVote,this))})}(window);